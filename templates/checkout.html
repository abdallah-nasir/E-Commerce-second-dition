{% extends 'base.html' %}

{% block content %}
<script src="https://polyfill.io/v3/polyfill.min.js?version=3.52.1&features=fetch"></script>

<script src="https://www.paypal.com/sdk/js?client-id=AUVCElDtljJUDVWukP9yrdedNic0J1B1XY1MtNfPhqxQU47F1F1A7C6ixKabvUCRZCTpkFihHBaTPR-F&currency=USD" ></script>

        <!--====== App Content ======-->
<div class="app-content">


            <!--====== Section 1 ======-->
            <div class="u-s-p-y-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="breadcrumb">
                            <div class="breadcrumb__wrap">
                                <ul class="breadcrumb__list">
                                    <li class="has-separator">
                                        <a href="{% url 'home:home' %}">Home</a></li>
                                    <li class="is-marked">

                                        <a href="{% url 'home:order' id=cart.id %}">Checkout</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--====== End - Section 1 ======-->


            <!--====== Section 2 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div id="checkout-msg-group">
                                     <!-- <div class="msg u-s-m-b-30">

                                        <span class="msg__text">Returning customer?

                                            <a class="gl-link" href="#return-customer" data-toggle="collapse">Click here to login</a></span>
                                        <div class="collapse" id="return-customer" data-parent="#checkout-msg-group">
                                            <div class="l-f u-s-m-b-16">

                                                <span class="gl-text u-s-m-b-16">If you have an account with us, please log in.</span>
                                                <form class="l-f__form">
                                                    <div class="gl-inline">
                                                        <div class="u-s-m-b-15">

                                                            <label class="gl-label" for="login-email">E-MAIL *</label>

                                                            <input class="input-text input-text--primary-style" type="text" id="login-email" placeholder="Enter E-mail"></div>
                                                        <div class="u-s-m-b-15">

                                                            <label class="gl-label" for="login-password">PASSWORD *</label>

                                                            <input class="input-text input-text--primary-style" type="text" id="login-password" placeholder="Enter Password"></div>
                                                    </div>
                                                    <div class="gl-inline">
                                                        <div class="u-s-m-b-15">

                                                            <button class="btn btn--e-transparent-brand-b-2" type="submit">LOGIN</button></div>
                                                        <div class="u-s-m-b-15">

                                                            <a class="gl-link" href="lost-password.html">Lost Your Password?</a></div>
                                                    </div>

                                                    
                                                    <div class="check-box">

                                                        <input type="checkbox" id="remember-me">
                                                        <div class="check-box__state check-box__state--primary">

                                                            <label class="check-box__label" for="remember-me">Remember Me</label></div>
                                                    </div>
                                                   
                                                </form>
                                            </div>
                                        </div>
                                    </div>  -->
                                    <div class="msg">

                                        <span class="msg__text">Have a coupon?

                                            <a class="gl-link" href="#have-coupon" data-toggle="collapse">Click Here to enter your code</a></span>
                                        <div class="collapse" id="have-coupon" data-parent="#checkout-msg-group">
                                            <div class="c-f u-s-m-b-16">

                                                <span class="gl-text u-s-m-b-16">Enter your coupon code if you have one.</span>
                                                <form method="POST" action="{% url 'home:coupon' %}" class="c-f__form">
                                                {% csrf_token %}
                                                    <div class="u-s-m-b-16">
                                                        <div class="u-s-m-b-15">

                                                            <label for="coupon"></label>

                                                            <input class="input-text input-text--primary-style" name="coupon" type="text" id="coupon" placeholder="Coupon Code" required {% if order.coupon %}disabled {% endif %}>
                                                            {% if order.coupon %}
                                                             <p>COUPON [{{order.coupon.coupon|upper}}] APPLIED</p>
                                                             {% endif %}
                                                            </div>
                                                            
                                                           
                                                        <div class="u-s-m-b-15">

                                                            <button class="btn btn--e-transparent-brand-b-2" type="submit"  {% if order.coupon %}disabled {% endif %}>APPLY</button></div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 2 ======-->


            <!--====== Section 3 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="checkout-f">
                            <div class="row">
                                <div class="col-lg-6">
                                    <h1 class="checkout-f__h1">DELIVERY INFORMATION</h1>
                                    <form method="POST" class="checkout-f__delivery">
                                       {% csrf_token %}
                                        <div class="u-s-m-b-30">
                                            <div class="u-s-m-b-15">

                                                <!--====== Check Box ======-->
                                                <div class="check-box">

                                                    <input type="checkbox" name="default" id="get-address">
                                                    <div class="check-box__state check-box__state--primary">

                                                        <label class="check-box__label" for="get-address">Use default shipping and billing address from account</label></div>
                                                </div>
                                                <!--====== End - Check Box ======-->
                                            </div>

                                            <!--====== First Name, Last Name ======-->
                                            <!-- <div class="gl-inline">
                                                <div class="u-s-m-b-15">

                                                    <label class="gl-label" for="billing-fname">FIRST NAME *</label>

                                                    <input class="input-text input-text--primary-style" type="text" id="billing-fname" data-bill=""></div>
                                                <div class="u-s-m-b-15">

                                                    <label class="gl-label" for="billing-lname">LAST NAME *</label>

                                                    <input class="input-text input-text--primary-style" type="text" id="billing-lname" data-bill=""></div>
                                            </div> -->
                                            <!--====== End - First Name, Last Name ======-->


                                            <!--====== E-MAIL ======-->
                                            <!-- <div class="u-s-m-b-15">

                                                <label class="gl-label" for="billing-email">E-MAIL *</label>

                                                <input class="input-text input-text--primary-style" type="text" id="billing-email" data-bill=""></div> -->
                                            <!--====== End - E-MAIL ======-->


                                            <!--====== PHONE ======-->
                                            <div class="u-s-m-b-15">

                                                <label class="gl-label" for="billing-phone">PHONE *</label>

                                                <input name="phone" class="input-text input-text--primary-style" type="number" id="billing-phone" data-bill="" required></div>
                                            <!--====== End - PHONE ======-->


                                            <!-- <div class="u-s-m-b-15">

                                                <label for="billing-street-optional"></label>

                                                <input class="input-text input-text--primary-style" type="text" id="billing-street-optional" placeholder="Apartment, suite unit etc. (optional)" data-bill=""></div> -->
                                            <!--====== End - Street Address ======-->


                                            <!--====== Country ======-->
                                            <div class="u-s-m-b-15">

                                                <!--====== Select Box ======-->

                                                <label class="gl-label" for="billing-country">COUNTRY *</label><select name="country" class="select-box select-box--primary-style" id="billing-country" data-bill="" required>
                                                    <option selected value="">Choose Country</option>
                                                    <option value="uae">United Arab Emirate (UAE)</option>
                                                    <option value="uk">United Kingdom (UK)</option>
                                                    <option value="us">United States (US)</option>
                                                </select>
                                                <!--====== End - Select Box ======-->
                                            </div>
                                            <!--====== End - Country ======-->


                                            <!--====== Town / City ======-->
                                            <!-- <div class="u-s-m-b-15">

                                                <label class="gl-label" for="billing-town-city">TOWN/CITY *</label>

                                                <input class="input-text input-text--primary-style" type="text" id="billing-town-city" data-bill=""></div> -->
                                            <!--====== End - Town / City ======-->


                                            <!--====== STATE/PROVINCE ======-->
                                            <div class="u-s-m-b-15">

                                                <!--====== Select Box ======-->

                                                <label class="gl-label" for="billing-state">CITY *</label><select name="city" class="select-box select-box--primary-style" id="billing-state" data-bill="" required>
                                                    <option selected value="">Choose State/Province</option>
                                                    {% for i in cities %}
                                                    <option value="{{i.id}}">{{i.name|title}}, {{i.region|title}}</option>

                                                    {% endfor %}
                                                </select>
                                                <!--====== End - Select Box ======-->
                                            </div>
                                            <!--====== End - STATE/PROVINCE ======-->

                                            <!--====== Street Address ======-->
                                            <div class="u-s-m-b-15">

                                                <label class="gl-label" for="billing-street">STREET ADDRESS *</label>

                                                <input name="street" class="input-text input-text--primary-style" type="text" id="billing-street" placeholder="House name and street name" data-bill=""required>
                                            </div>

                                            <!--====== ZIP/POSTAL ======-->
                                            <div class="u-s-m-b-15">

                                                <label class="gl-label" for="billing-zip">ZIP/POSTAL CODE *</label>

                                                <input name="zip" class="input-text input-text--primary-style" type="number" id="billing-zip" placeholder="Zip/Postal Code" data-bill="" required></div>
                                            <!--====== End - ZIP/POSTAL ======-->
                                            <div class="u-s-m-b-10">

                                                <!--====== Check Box ======-->
                                                <div class="check-box">

                                                    <input name="primary" type="checkbox" id="make-default-address" data-bill="">
                                                    <div class="check-box__state check-box__state--primary">

                                                        <label class="check-box__label" for="make-default-address">Make default shipping and billing address</label></div>
                                                </div>
                                                <!--====== End - Check Box ======-->
                                            </div>
                                            <div class="u-s-m-b-10">

                                                <!-- <a class="gl-link" href="#create-account" data-toggle="collapse">Want to create a new account?</a> -->
                                            </div>

                                            <!-- <div class="collapse u-s-m-b-15" id="create-account">

                                                <span class="gl-text u-s-m-b-15">Create an account by entering the information below. If you are a returning customer please login at the top of the page.</span>
                                                <div>

                                                    <label class="gl-label" for="reg-password">Account Password *</label>

                                                    <input class="input-text input-text--primary-style" type="text" data-bill id="reg-password"></div>
                                           </div>  -->
                                            <div class="u-s-m-b-10">

                                                <label class="gl-label" for="order-note">ORDER NOTE</label><textarea class="text-area text-area--primary-style" id="order-note"></textarea></div>
                                            <div>

                                                <button class="btn btn--e-transparent-brand-b-2" type="submit">SAVE</button></div>
                                        </div>
                                    </form>
                                </div>
                                <div class="col-lg-6">
                                    <h1 class="checkout-f__h1">ORDER SUMMARY</h1>

                                    <!--====== Order Summary ======-->
                                    <div class="o-summary">
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__item-wrap gl-scroll">
                                                
                                                {% for i in order.cart.products.all %}
                                                
                                                <div class="o-card">
                                                    <div class="o-card__flex">
                                                        <div class="o-card__img-wrap">

                                                            <img class="u-img-fluid" src="{{i.products.image.first.image.url}}" alt=""></div>
                                                        <div class="o-card__info-wrap">

                                                            <span class="o-card__name">

                                                                <a href="{% url 'home:this_product' id=i.products.id %}">{{i.products.name|title}}</a></span>

                                                            <span class="o-card__quantity">Quantity x {{i.quantity}}</span>

                                                            <span class="o-card__price">${{i.discount}}</span></div>
                                                    </div>

                                                    <a class="o-card__del far fa-trash-alt" href='{% url "home:cart_remove" id=i.products.id %}'></a>
                                                </div>
                                               {% endfor %}
                                            </div>
                                        </div>
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__box">
                                                <h1 class="checkout-f__h1">SHIPPING & BILLING</h1>
                                                <div class="ship-b">

                                                    <span class="ship-b__text">Ship to:</span>
                                                    <div class="ship-b__box u-s-m-b-10">
                                                        <p class="ship-b__p">{{my_address.street}}-{{my_address.city}} {{my_address.country|upper}} {{my_address.phone}}</p>

                                                        <a class="ship-b__edit btn--e-transparent-platinum-b-2" data-modal="modal" data-modal-id="#edit-ship-address">Edit</a>
                                                    </div>
                                                    <!-- <div class="ship-b__box">

                                                        <span class="ship-b__text">Bill to default billing address</span>

                                                        <a class="ship-b__edit btn--e-transparent-platinum-b-2" data-modal="modal" data-modal-id="#edit-ship-address">Edit</a></div> -->
                                                </div>
                                            </div>
                                        </div>
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__box">
                                                <table class="o-summary__table">
                                                    <tbody>
                                                        <tr>
                                                            <td>TOTAL</td>
                                                            
                                                            <td>${{order.cart.total_price}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>SHIPPING</td>
                                                            <td>$0.00</td>
                                                        </tr>
                                                        <tr>
                                                            <td>TAX</td>
                                                            <td>$0.00</td>
                                                        </tr>
                                                        <tr>
                                                            <td>DISCOUNT</td>
                                                            {% if order.coupon %}
                                                            <td>%{{order.coupon.value}}</td>
                                                            {% else %}
                                                            <td>%0</td>

                                                            {% endif %}
                                                        </tr>
                                                        <tr>
                                                            <td>SUBTOTAL</td>
                                                            <td>${{order.price}}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>GRAND TOTAL</td>
                                                            <td>${{order.price}}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__box">
                                                <h1 class="checkout-f__h1">PAYMENT INFORMATION</h1>
                                                <form method='POST' action="{%  url 'home:make_payment_option' %}" class="checkout-f__payment">
                                                    {% csrf_token %}
                                                    <div class="u-s-m-b-10">

                                                        <!--====== Radio Box ======-->
                                                        <div class="radio-box">

                                                            <input type="radio" id="cash-on-delivery" value="Cash on Delivery" name="payment">
                                                            <div class="radio-box__state radio-box__state--primary">

                                                                <label class="radio-box__label" for="cash-on-delivery">Cash on Delivery</label></div>
                                                        </div>
                                                        <!--====== End - Radio Box ======-->

                                                        <span class="gl-text u-s-m-t-6">Pay Upon Cash on delivery. (This service is only available for some countries)</span>
                                                    </div>
                                                    <!-- <div class="u-s-m-b-10">

                                                       
                                                        <div class="radio-box">

                                                            <input type="radio" id="direct-bank-transfer" name="payment">
                                                            <div class="radio-box__state radio-box__state--primary">

                                                                <label class="radio-box__label" for="direct-bank-transfer">Direct Bank Transfer</label></div>
                                                        </div>
                                                      

                                                        <span class="gl-text u-s-m-t-6">Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order will not be shipped until the funds have cleared in our account.</span>
                                                    </div> -->
                                                    <!-- <div class="u-s-m-b-10">

                                                        <div class="radio-box">

                                                            <input type="radio" id="pay-with-check" name="payment">
                                                            <div class="radio-box__state radio-box__state--primary">

                                                                <label class="radio-box__label" for="pay-with-check">Pay With Check</label></div>
                                                        </div>

                                                        <span class="gl-text u-s-m-t-6">Please send a check to Store Name, Store Street, Store Town, Store State / County, Store Postcode.</span>
                                                    </div> -->
                                                    <div class="u-s-m-b-10">

                                                        <div class="radio-box">

                                                            <input type="radio" id="pay-with-card" value="Credit / Debit Card" name="payment">
                                                            <div class="radio-box__state radio-box__state--primary">

                                                                <label class="radio-box__label" for="pay-with-card">Pay With Credit / Debit Card</label></div>
                                                        </div>

                                                        <span class="gl-text u-s-m-t-6">International Credit Cards must be eligible for use within the United States.</span>
                                                    </div>
                                                    <div class="u-s-m-b-10">

                                                        <!--====== Radio Box ======-->
                                                        <div class="radio-box">

                                                            <input type="radio" id="pay-pal" value="PayPal" name="payment">
                                                            <div class="radio-box__state radio-box__state--primary">

                                                                <label class="radio-box__label" for="pay-pal">Pay Pal</label></div>
                                                        </div>
                                                        <!--====== End - Radio Box ======-->

                                                        <span class="gl-text u-s-m-t-6">When you click "Place Order" below we'll take you to Paypal's site to set up your billing information.</span>
                                                    </div>
                                                    <div class="u-s-m-b-15">

                                                        <!--====== Check Box ======-->
                                                        <div class="check-box">

                                                            <input type="checkbox" id="term-and-condition">
                                                            <div class="check-box__state check-box__state--primary">

                                                                <label class="check-box__label" for="term-and-condition">I consent to the</label></div>
                                                        </div>
                                                        <!--====== End - Check Box ======-->

                                                        <a class="gl-link">Terms of Service.</a>
                                                    </div>
                                                    <div>

                                                        <button class="btn btn--e-brand-b-2" type="submit">PLACE ORDER</button></div>
                                                </form>
                                        <div id="paypal-button-container"  ></div></div>

                                            </div>
                                        </div>
                                    </div>
                                    <!--====== End - Order Summary ======-->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 3 ======-->
</div>
        <!--====== End - App Content ======-->


              <!--====== Shipping Address Add Modal ======-->
              <div class="modal fade" id="edit-ship-address">
                  
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div class="checkout-modal2">
                                <div class="u-s-m-b-30">
                                    <div class="dash-l-r">
                                        <h1 class="gl-modal-h1">Shipping Address</h1>
                                        <div class="dash__link dash__link--brand">
    
                                            <a data-modal="modal" data-modal-id="#add-ship-address" data-dismiss="modal">Add new Address</a></div>
                                    </div>
                                </div>
                                <form method="POST" action="{% url 'home:make_primary'  %}" class="checkout-modal2__form">
                                   {% csrf_token %}
                                    <div class="dash__table-2-wrap u-s-m-b-30 gl-scroll">
                                        <table class="dash__table-2">
                                            <thead>
                                                <tr>
                                                    <th>Action</th>
                                                    <th>Full Name</th>
                                                    <th>Address</th>
                                                   
                                                    <th>Phone Number</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for i in all %}
                                                <tr>
                                                    <td>
    
                                                        <!--====== Radio Box ======-->
                                                        <div class="radio-box">
    
                                                            <input value="{{i.id}}" type="radio" id="address-1" name="default-address" {% if i.primary %}checked{% endif %}>
                                                            <div class="radio-box__state radio-box__state--primary">
    
                                                                <label class="radio-box__label" for="address-1"></label></div>
                                                        </div>
                                                        <!--====== End - Radio Box ======-->
                                                    </td>
                                                    <td>{{i.profile.user.first_name|title}} {{i.profile.user.last_name|title}}</td>
                                                    <td>{{i.street}} {{i.city}} {{i.country|upper}}</td>
                                                    
                                                    <td>{{i.phone}}</td>
                                                    <td>
                                                        {% if i.primary %}
                                                        <div class="gl-text">Default Shipping Address</div>
                                                    {% else %}
                                                    <div class="gl-text"></div>

                                                    {% endif %}
                                                    </td>
                                                </tr>
                                               {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="gl-modal-btn-group">
    
                                        <button class="btn btn--e-brand-b-2" type="submit">SAVE</button>
    
                                        <button class="btn btn--e-grey-b-2" type="button" data-dismiss="modal">CANCEL</button></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--====== End - Shipping Address Add Modal ======-->
    

        <!--====== Shipping Address Add Modal ======-->
        <div class="modal fade" id="add-ship-address">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="checkout-modal1">
                            <form method='POST' action="{%  url 'home:make_new_address' %}" class="checkout-modal1__form">
                                {% csrf_token %}
                                <div class="u-s-m-b-30">
                                    <h1 class="gl-modal-h1">Add new Shipping Address</h1>
                                </div>
                                <!-- <div class="gl-inline">
                                    <div class="u-s-m-b-30">

                                        <label class="gl-label" for="address-fname">FIRST NAME *</label>

                                        <input class="input-text input-text--primary-style" type="text" id="address-fname" placeholder="First Name"></div>
                                    <div class="u-s-m-b-30">

                                        <label class="gl-label" for="address-lname">LAST NAME *</label>

                                        <input class="input-text input-text--primary-style" type="text" id="address-lname" placeholder="Last Name"></div>
                                </div> -->
                                <div class="gl-inline">
                                    <div class="u-s-m-b-30">

                                        <label class="gl-label" for="address-phone">PHONE *</label>

                                        <input class="input-text input-text--primary-style" name="phone" type="number" id="address-phone"></div>
                                    <div class="u-s-m-b-30">

                                        <label class="gl-label" for="address-street">STREET ADDRESS *</label>

                                        <input class="input-text input-text--primary-style" name="street" type="text" id="address-street" placeholder="House Name and Street"></div>
                                </div>
                                <div class="gl-inline">
                                    <div class="u-s-m-b-30">

                                        <!--====== Select Box ======-->

                                        <label class="gl-label" for="address-country">COUNTRY *</label><select name="country" class="select-box select-box--primary-style" id="address-country">
                                            <option selected value="">Choose Country</option>
                                            <option value="uae">United Arab Emirate (UAE)</option>
                                            <option value="uk">United Kingdom (UK)</option>
                                            <option value="us">United States (US)</option>
                                        </select>
                                        <!--====== End - Select Box ======-->
                                    </div>
                                    <div class="u-s-m-b-30">

                                        <!--====== Select Box ======-->

                                        <label class="gl-label" for="address-state">CITY *</label><select name="city" class="select-box select-box--primary-style" id="address-state">
                                            <option selected value="">Choose State/Province</option>
                                            {% for i in cities  %}
                                            <option value="{{i.id}}">{{i.name|title}},{{i.region|title}} </option>
                                            {% endfor %}
                                        </select>
                                        <!--====== End - Select Box ======-->
                                    </div>
                                </div>
                                <div class="gl-inline">
                                    <!-- <div class="u-s-m-b-30">

                                        <label class="gl-label" for="address-city">TOWN/CITY *</label>

                                        <input class="input-text input-text--primary-style" type="text" id="address-city"></div> -->
                                    <div class="u-s-m-b-30">

                                        <label class="gl-label" for="address-street">ZIP/POSTAL CODE *</label>

                                        <input name="zip" class="input-text input-text--primary-style" type="number" id="address-postal" placeholder="Zip/Postal Code"></div>
                                </div>
                                <div class="gl-modal-btn-group">

                                    <button class="btn btn--e-brand-b-2" type="submit">SAVE</button>

                                    <button class="btn btn--e-grey-b-2" type="button" data-dismiss="modal">CANCEL</button></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--====== End - Shipping Address Add Modal ======-->
        <!--====== End - Modal Section ======-->    
        <script type="text/javascript">

            // Render the PayPal button into #paypal-button-container
            paypal.Buttons({
             style: {
               layout: 'horizontal',
               color:"blue",
               label:"checkout",
             tagline:"false",
             shape:"pill",
             size:"small",
       
       
           },
       
                   // Call your server to set up the transaction
                   createOrder: function(data, actions) {
                     return fetch('{% url "home:create" id=order.id %}', {
                         method: 'post',
                         headers: {"X-CSRFToken": csrftoken}
                     }).then(function(res) {
                         return res.json();
                     }).then(function(orderData) {
                         return orderData.id;
                     });
                 },
       
                 // Call your server to finalize the transaction
                 onApprove: function(data, actions) {
                     return fetch('/capture/' + data.orderID + '/{{order.id}}/', {
                         method: 'post',
                         headers: {"X-CSRFToken": csrftoken}
                     }).then(function(res) {
                      
                       window.location.href = '{% url "home:home" %}';
       
                         return res.json();
                     }).then(function(orderData) {
                      
                         // Three cases to handle:
                         //   (1) Recoverable INSTRUMENT_DECLINED -> call actions.restart()
                         //   (2) Other non-recoverable errors -> Show a failure message
                         //   (3) Successful transaction -> Show a success / thank you message
       
                         // Your server defines the structure of 'orderData', which may differ
                         var errorDetail = Array.isArray(orderData.details) && orderData.details[0];
       
                         if (errorDetail && errorDetail.issue === 'INSTRUMENT_DECLINED') {
                             // Recoverable state, see: "Handle Funding Failures"
                             // https://developer.paypal.com/docs/checkout/integration-features/funding-failure/
                             return actions.restart();
                         }
       
                         if (errorDetail) {
                             var msg = 'Sorry, your transaction could not be processed.';
                             if (errorDetail.description) msg += '\n\n' + errorDetail.description;
                             if (orderData.debug_id) msg += ' (' + orderData.debug_id + ')';
                             // Show a failure message
                             return alert(msg);
                         }
       
                         // Show a success message to the buyer
                        
                     });
                 }
       
       
            }).render('#paypal-button-container');
        </script>
{% endblock %}
     